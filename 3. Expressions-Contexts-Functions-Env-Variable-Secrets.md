# GitHub Actions: Expressions and Contexts Explained

GitHub Actions provides powerful features for dynamic workflow control through expressions and contexts. These allow you to evaluate conditions, access runtime information, and make decisions in your workflows.

## Reference Links
- [Expressions Documentation](https://docs.github.com/en/actions/reference/evaluate-expressions-in-workflows-and-actions)
- [Contexts Documentation](https://docs.github.com/en/actions/reference/accessing-contextual-information-about-workflow-runs)

## Understanding Expressions

Expressions are evaluated at runtime and can be used to:
- Set environment variables
- Determine job/skip conditions
- Pass values between steps
- Make decisions in your workflow

### Basic Expression Syntax

```yaml
${{ <expression> }}
```

## Common Contexts

Contexts are objects that contain information about:
- Workflow run (`github`)
- Job status (`needs`)
- Runner environment (`runner`)
- Step outputs (`steps`)
- And more

### 1. GitHub Context Example

```yaml
name: PR Info Check
on: [pull_request]

jobs:
  check-pr:
    runs-on: ubuntu-latest
    steps:
      - name: Show PR Info
        run: |
          echo "PR Number: ${{ github.event.number }}"
          echo "PR Title: ${{ github.event.pull_request.title }}"
          echo "Actor: ${{ github.actor }}"
          echo "Repository: ${{ github.repository }}"
          echo "Event Name: ${{ github.event_name }}"
          echo "SHA: ${{ github.sha }}"
```

### 2. Job Status Context (`needs`)

```yaml
name: Dependent Jobs
on: push

jobs:
  build:
    runs-on: ubuntu-latest
    outputs:
      build_id: ${{ steps.set-output.outputs.build_id }}
    steps:
      - id: set-output
        run: echo "build_id=$(date +%s)" >> $GITHUB_OUTPUT

  test:
    needs: build
    runs-on: ubuntu-latest
    steps:
      - run: echo "Using build ID ${{ needs.build.outputs.build_id }}"

  deploy:
    needs: [build, test]
    if: ${{ needs.build.result == 'success' && needs.test.result == 'success' }}
    runs-on: ubuntu-latest
    steps:
      - run: echo "Deploying build ${{ needs.build.outputs.build_id }}"
```

## Advanced Expression Examples

### 1. Conditional Execution

```yaml
name: Conditional Workflow
on: push

jobs:
  check-changes:
    runs-on: ubuntu-latest
    outputs:
      docs-changed: ${{ steps.check-files.outputs.docs-changed }}
    steps:
      - uses: actions/checkout@v4
      
      - id: check-files
        run: |
          changes=$(git diff --name-only HEAD~1 HEAD | grep -c '^docs/')
          echo "docs-changed=$([ $changes -gt 0 ] && echo "true" || echo "false")" >> $GITHUB_OUTPUT

  build-docs:
    needs: check-changes
    if: ${{ needs.check-changes.outputs.docs-changed == 'true' }}
    runs-on: ubuntu-latest
    steps:
      - run: echo "Building documentation..."
```

### 2. Complex Conditions

```yaml
name: Smart Deployment
on:
  push:
    branches: [ main ]
  pull_request:
    types: [closed]

jobs:
  deploy:
    runs-on: ubuntu-latest
    if: |
      ${{ 
        github.event_name == 'push' || 
        (github.event_name == 'pull_request' && 
         github.event.pull_request.merged == true)
      }}
    steps:
      - run: echo "Deploying to production..."
```

### 3. Matrix with Expressions

```yaml
name: Matrix Build
on: push

jobs:
  build:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        version: [10, 12, 14]
        os: [ubuntu-latest, windows-latest]
        exclude:
          - os: windows-latest
            version: 10
    steps:
      - name: Build with Node ${{ matrix.version }} on ${{ matrix.os }}
        run: |
          echo "Building for Node.js ${{ matrix.version }}"
          echo "Running on ${{ runner.os }}"
          echo "Event was triggered by ${{ github.actor }}"
```

## Context Object Reference

Here are some commonly used context properties:

### `github` context:
- `github.actor`: Who triggered the workflow
- `github.event`: The full webhook payload
- `github.event_name`: The name of the triggering event
- `github.repository`: The repository name
- `github.ref`: The branch or tag ref
- `github.sha`: The commit SHA

### `env` context:
- Access environment variables
- `${{ env.MY_VAR }}`

### `steps` context:
- Access outputs from previous steps
- `${{ steps.step-id.outputs.output-name }}`

### `runner` context:
- `runner.os`: The runner's operating system
- `runner.temp`: Temporary directory path
- `runner.tool_cache`: Tool cache directory

## Best Practices

1. **Quote expressions** when they might evaluate to empty strings
2. **Use simple conditions** for better readability
3. **Test complex expressions** thoroughly
4. **Use outputs** to pass data between jobs
5. **Prefer contexts** over environment variables when possible

## Debugging Expressions

Add a debug step to see context values:

```yaml
- name: Debug context
  run: |
    echo "Event payload: ${{ toJSON(github.event) }}"
    echo "Full github context: ${{ toJSON(github) }}"
    echo "Job context: ${{ toJSON(job) }}"
```

Expressions and contexts provide the flexibility to create dynamic, responsive workflows that adapt to different situations and make decisions based on runtime information.
