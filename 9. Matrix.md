# GitHub Actions: Running a Job Multiple Times Using a Matrix

## Matrix Strategy

The matrix strategy lets you run a job multiple times with different combinations of variables. This is useful for testing across multiple operating systems, language versions, or other configurations.


## âœ… What is a Matrix Strategy in GitHub Actions?

Matrix allows you to run a job **multiple times in parallel**, varying parameters like:

* OS
* Environment (dev/staging/prod)
* Versions (Java, Python, etc.)

This is great for:

* Testing across multiple environments
* Deploying to multiple regions
* Running the same logic against multiple configs

---

## ðŸ§ª Real-World Example: Deploy to Multiple Environments

Imagine you want to **run a shell-based deploy job to 3 environments** â€” `dev`, `staging`, and `prod`.

```yaml
name: Multi-Env Deployment using Matrix

on:
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest

    strategy:
      matrix:
        environment: [dev, staging, prod]

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Deploy to ${{ matrix.environment }}
        run: |
          echo "Starting deployment to ${{ matrix.environment }} environment"
          sleep 3
          echo "Deployment to ${{ matrix.environment }} completed successfully"
```

---

### ðŸ§¾ Explanation:

* `matrix.environment` creates **3 parallel jobs**:
  one each for `dev`, `staging`, and `prod`.
* Each job will run the same steps, but with its **own value of `matrix.environment`**.
* You can customize steps per environment if needed using `if:` conditionals.

---

### âœ… Output:

You will see:

* One job for `dev`
* One job for `staging`
* One job for `prod`
  All running **independently and in parallel**.

---

## Complete Example (Non-NPM)

Here's a practical example testing a Python script across different operating systems and Python versions:

```yaml
name: Multi-Platform Python Tests

on: [push]

jobs:
  test:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-latest, macos-latest, windows-latest]
        python-version: ["3.8", "3.9", "3.10"]
        include:
          - os: ubuntu-latest
            extra-pkg: "python3-dev"
          - os: macos-latest
            extra-pkg: "openssl"
          - os: windows-latest
            extra-pkg: "python"
        exclude:
          - os: windows-latest
            python-version: "3.8"  # Don't test Python 3.8 on Windows
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v4
      with:
        python-version: ${{ matrix.python-version }}
        
    - name: Install system dependencies
      if: runner.os != 'Windows'  # Skip on Windows
      run: |
        sudo apt-get update
        sudo apt-get install -y ${{ matrix.extra-pkg }}
        
    - name: Run tests
      run: |
        python -m pip install pytest
        python -m pytest tests/
        
    - name: Upload test results
      uses: actions/upload-artifact@v3
      if: always()  # Upload even if tests fail
      with:
        name: test-results-${{ matrix.os }}-py${{ matrix.python-version }}
        path: test-reports/
```

## Key Components:

1. **Matrix Definition**:
   - `os`: Tests run on Ubuntu, macOS, and Windows
   - `python-version`: Tests with Python 3.8, 3.9, and 3.10
   - `include`: Adds extra variables specific to each OS
   - `exclude`: Skips Python 3.8 tests on Windows

2. **Job Execution**:
   - This creates 8 jobs (3 OS Ã— 3 Python versions, minus 1 excluded combination)
   - Each job gets its combination of `os`, `python-version`, and `extra-pkg`

3. **Accessing Matrix Values**:
   - Use `${{ matrix.variable-name }}` to access matrix values in steps
   - Example: `${{ matrix.os }}` and `${{ matrix.python-version }}`

## Advanced Matrix Features:

1. **Dynamic Matrices** (from outputs):
```yaml
strategy:
  matrix:
    version: ${{ fromJSON(needs.setup.outputs.versions) }}
```

2. **Fail Fast**:
```yaml
strategy:
  fail-fast: true  # Stop all jobs if one fails (default)
  # or false to continue other jobs if one fails
```

## Official Documentation References:

- [Using a matrix for your jobs](https://docs.github.com/en/actions/using-jobs/using-a-matrix-for-your-jobs)
- [Workflow syntax for jobs.<job_id>.strategy.matrix](https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions#jobsjob_idstrategymatrix)

This example demonstrates matrix usage for cross-platform testing without npm, showing how to test Python code across different operating systems and language versions while handling platform-specific requirements.

## ðŸ§· Real-World Use Cases:

* Testing an Ansible playbook across multiple OSes.
* Running Terraform plan against different workspaces.
* Validating Bash scripts with multiple input parameters.

---

## ðŸ”— Official Docs:

* Matrix strategy documentation:
  [https://docs.github.com/en/actions/using-jobs/using-a-matrix-for-your-jobs](https://docs.github.com/en/actions/using-jobs/using-a-matrix-for-your-jobs)

---


